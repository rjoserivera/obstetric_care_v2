{% extends 'Shared/base.html' %}
{% load static %}

{% block title %}Gestión de Personas{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row mb-4">
        <div class="col-lg-12">
            <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 2rem; border-radius: 12px;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <h1 style="font-weight: 800; margin: 0 0 0.5rem 0; font-size: 2rem;">
                            <i class="bi bi-people-fill"></i> Gestión de Personas
                        </h1>
                        <p style="margin: 0; opacity: 0.9;">Administra todas las personas registradas en el sistema</p>
                    </div>
                    <a href="{% url 'core:personas_create' %}" class="btn" style="background: white; color: #667eea; font-weight: 700; padding: 0.75rem 1.5rem;">
                        <i class="bi bi-person-plus-fill"></i> Agregar Persona
                    </a>
                </div>
            </div>
        </div>
    </div>

    <div class="row mb-4">
        <div class="col-lg-12">
            <div class="card" style="border: none; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.08);">
                <div class="card-body">
                    <form method="GET" class="row g-3">
                        <div class="col-md-9">
                            <input 
                                type="text" 
                                name="q" 
                                class="form-control form-control-lg" 
                                placeholder="Buscar por nombre, RUT o email..."
                                value="{{ query }}"
                                style="border-radius: 8px; border: 2px solid #d1d5db;"
                            >
                        </div>
                        <div class="col-md-3">
                            <button type="submit" class="btn btn-lg w-100" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; font-weight: 600; border-radius: 8px;">
                                <i class="bi bi-search"></i> Buscar
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-lg-12">
            <div class="card" style="border: none; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.08);">
                <div style="padding: 1.5rem; border-bottom: 1px solid #e5e7eb;">
                    <h5 style="margin: 0; color: #2c3e50; font-weight: 700;">
                        <i class="bi bi-list-check"></i> Listado de Personas
                        <span class="badge bg-primary" style="margin-left: 0.5rem;">{{ personas.count }} registros</span>
                    </h5>
                </div>
                
                {% if personas %}
                    <div class="table-responsive">
                        <table class="table table-hover" style="margin: 0;">
                            <thead style="background: #f9fafb;">
                                <tr>
                                    <th style="font-weight: 700; color: #2c3e50; padding: 1rem;">RUT</th>
                                    <th style="font-weight: 700; color: #2c3e50; padding: 1rem;">Nombre Completo</th>
                                    <th style="font-weight: 700; color: #2c3e50; padding: 1rem;">Email</th>
                                    <th style="font-weight: 700; color: #2c3e50; padding: 1rem;">Teléfono</th>
                                    <th style="font-weight: 700; color: #2c3e50; padding: 1rem;">Comuna</th>
                                    <th style="font-weight: 700; color: #2c3e50; padding: 1rem;">Acciones</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for persona in personas %}
                                    <tr style="border-bottom: 1px solid #e5e7eb;">
                                        <td style="color: #2c3e50; font-weight: 600; padding: 1rem;">
                                            {{ persona.Rut }}
                                        </td>
                                        <td style="color: #2c3e50; padding: 1rem; font-weight: 600;">
                                            {{ persona.Nombre }} {{ persona.Apellido_Paterno }} {{ persona.Apellido_Materno }}
                                        </td>
                                        <td style="color: #2c3e50; padding: 1rem;">
                                            {% if persona.Email %}
                                                <a href="mailto:{{ persona.Email }}" style="color: #667eea; text-decoration: none;">
                                                    {{ persona.Email }}
                                                </a>
                                            {% else %}
                                                <span style="color: #ccc;">N/A</span>
                                            {% endif %}
                                        </td>
                                        <td style="color: #2c3e50; padding: 1rem;">{{ persona.Telefono }}</td>
                                        <td style="color: #2c3e50; padding: 1rem;">
                                            {% if persona.Comuna %}
                                                <span style="background: #e0e7ff; color: #4c1d95; padding: 0.25rem 0.75rem; border-radius: 4px; font-size: 0.85rem; font-weight: 600;">
                                                    {{ persona.Comuna }}
                                                </span>
                                            {% else %}
                                                <span style="color: #ccc;">N/A</span>
                                            {% endif %}
                                        </td>
                                        <td style="padding: 1rem;">
                                            <div class="btn-group btn-group-sm" role="group">
                                                <a href="{% url 'core:personas_edit' persona.id %}" class="btn btn-sm" style="background: #dbeafe; color: #1e40af; border: 1px solid #bfdbfe; font-weight: 600; padding: 0.5rem 0.75rem; border-radius: 6px 0 0 6px;">
                                                    <i class="bi bi-pencil-square"></i>
                                                </a>
                                                <a href="{% url 'core:personas_detail' persona.id %}" class="btn btn-sm" style="background: #e0e7ff; color: #4c1d95; border: 1px solid #c7d2fe; font-weight: 600; padding: 0.5rem 0.75rem;">
                                                    <i class="bi bi-eye"></i>
                                                </a>
                                                <a href="{% url 'core:personas_delete' persona.id %}" class="btn btn-sm" style="background: #fee2e2; color: #991b1b; border: 1px solid #fecaca; font-weight: 600; padding: 0.5rem 0.75rem; border-radius: 0 6px 6px 0;" onclick="return confirm('¿Estás seguro?');">
                                                    <i class="bi bi-trash"></i>
                                                </a>
                                            </div>
                                        </td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% else %}
                    <div style="padding: 3rem 2rem; text-align: center;">
                        <i class="bi bi-inbox" style="font-size: 3rem; color: #d1d5db; margin-bottom: 1rem; display: block;"></i>
                        <h5 style="color: #2c3e50;">No hay personas registradas</h5>
                        <a href="{% url 'core:personas_create' %}" class="btn" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; font-weight: 600; padding: 0.75rem 1.5rem; border-radius: 8px;">
                            <i class="bi bi-person-plus-fill"></i> Crear Primera Persona
                        </a>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}